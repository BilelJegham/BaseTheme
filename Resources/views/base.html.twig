{#
 # Main base HTML file.
 #}
{% set pageMetaDescription = pageMetaDescription|default(pageMeta.description)|default(meta.siteDescription) %}
{% set pageMetaTitle = pageMetaTitle|default(pageMeta.title)|default(meta.siteName) %}
{% set formattedLocale = request.locale|replace('_', '-')|lower %}
{#  #}
{% set nodeName = nodeName|default(node.nodeName) %}
{% set nodeTypeName = nodeTypeName|default(node.nodeType.name) %}
{% set nodeHome = node.home|default(false) %}
{#  #}
{% set title = title|default(nodeSource.title) %}
{% set content = content|default(nodeSource.content) %}
{% if nodeSource and nodeSource.headerImage|length > 0 %}
    {% set headerImage = nodeSource.headerImage[0] %}
{% elseif nodeSource and nodeSource.headerImages|length > 0 %}
    {% set headerImage = nodeSource.headerImages[0] %}
{% endif %}
{# No whitespace before DOCTYPE #}
<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/WebPage" class="no-js" lang="{{ formattedLocale }}">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{{ pageMetaTitle }}</title>
    <meta name="description" content="{{ pageMetaDescription }}" />
    {% if pageMeta.keywords %}<meta name="keywords" content="{{ pageMeta.keywords }}" />{% endif %}
    <meta name="generator" content="Roadiz {{ cms_prefix }} {{ cms_version }} - {{ head.themeName }} v{{ head.themeVersion }}" />
    {#
     # This will enable mobile viewports
     #}
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    {#
     # HrefLang alternate url (Google suggestion), to activate ONLY if there
     # are more than 1 translation for your website
     #}
    {% if translation %}
        {% for key in translation|menu(true) %}
            <link rel="alternate" href="{{ key.url }}" hreflang="{{ key.locale|replace('_', '-')|lower }}" />
        {% endfor %}
    {% endif %}

    {#
     # Canonical url -----------------------------------------------------------
     #}
    {% if node %}
        <link rel="canonical" href="{{ url(nodeSource) }}" />
    {% endif %}

    {#
     # Favicons ----------------------------------------------------------------
     #}
    <link rel="apple-touch-icon" sizes="57x57" href="{{ head.resourcesUrl }}img/favicons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="{{ head.resourcesUrl }}img/favicons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="{{ head.resourcesUrl }}img/favicons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="{{ head.resourcesUrl }}img/favicons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="{{ head.resourcesUrl }}img/favicons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="{{ head.resourcesUrl }}img/favicons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="{{ head.resourcesUrl }}img/favicons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="{{ head.resourcesUrl }}img/favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ head.resourcesUrl }}img/favicons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="{{ head.resourcesUrl }}img/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="{{ head.resourcesUrl }}img/favicons/favicon-194x194.png" sizes="194x194">
    <link rel="icon" type="image/png" href="{{ head.resourcesUrl }}img/favicons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="{{ head.resourcesUrl }}img/favicons/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="{{ head.resourcesUrl }}img/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="{{ head.resourcesUrl }}img/favicons/manifest.json">
    <meta name="apple-mobile-web-app-title" content="{{ meta.siteName }}">
    <meta name="application-name" content="{{ meta.siteName }}">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/mstile-144x144.png">
    <meta name="theme-color" content="#ffffff">

    {#
     # Share metas -------------------------------------------------------------
     #}

    {% block share_metas %}

        {% if headerImage %}
            {% set previewImageUrl = headerImage|url(imageFormats.shareImage) %}
        {% else %}
            {% set previewImageUrl = head.absoluteResourcesUrl ~ 'img/share.png' %}
        {% endif %}

        {# Facebook #}
        <meta property="og:title" content="{{ title }}" />
        <meta property="og:site_name" content="{{ meta.siteName }}" />
        <meta property="og:description" content="{{ pageMetaDescription }}" />
        <meta property="og:url" content="{{ request.uri }}" />
        <meta property="og:image" content="{{ previewImageUrl }}" />
        <meta property="og:type" content="{{ ogType|default('article') }}" />
        {# Google plus #}
        <meta itemprop="name" content="{{ pageMetaTitle }}" />
        <meta itemprop="description" content="{{ pageMetaDescription }}" />
        <meta itemprop="image" content="{{ previewImageUrl }}" />
        {# Twitter #}
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:title" content="{{ pageMetaTitle }}" />
        <meta name="twitter:description" content="{{ pageMetaDescription }}" />
        {% if head.twitterAccount %}
            <meta name="twitter:site" content="{{ head.twitterAccount }}" />
            <meta name="twitter:creator" content="{{ head.twitterAccount }}" />
        {% endif %}
        <meta name="twitter:url" content="{{ request.uri }}" />
        <meta name="twitter:image" content="{{ previewImageUrl }}" />

    {% endblock %}
    {#
     # Gulp injected styles ----------------------------------------------------
     # Using gulp-inject
     # @see static/gulp-tasks/inject.js
     #}
    {% include '@BaseTheme/partials/css-inject.html.twig' %}
    {#
     # Roadiz font-face CSS (comment it if no fonts available) -----------------
     #}
    <link rel="stylesheet" href="{{ path('FontFaceCSS') }}" />
    {#
     # Dynamic CSS styles - uncomment next line to activate it -----------------
     #}
    {#<link rel="stylesheet" href="{{ path('CssDynamicStyles') }}" />#}

    {#
     # Modernizr ---------------------------------------------------------------
     #}
    <script src="{{ head.resourcesUrl }}vendors/modernizr.custom.js"></script>

    {% if head.googleTagManagerId %}
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
                new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','{{ head.googleTagManagerId }}');</script>
    <!-- End Google Tag Manager -->
    {% endif %}
</head>

{% set bodyClasses = [] %}
{% if node %}
    {% set bodyClasses = bodyClasses|merge([
        nodeTypeName|lower,
        nodeName,
        formattedLocale
    ]) %}
{% endif %}

<body {% block body_attributes %}{% if node %}class="{{ bodyClasses|join(' ') }}" id="{{nodeName }}" data-node-type="{{ nodeTypeName|lower }}" data-is-home="{{ nodeHome }}"{% endif %}{% endblock %}>
    {% if head.googleTagManagerId %}
        <!-- Google Tag Manager (noscript) -->
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id={{ head.googleTagManagerId }}"
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        <!-- End Google Tag Manager (noscript) -->
    {% endif %}
    <div id="svg-sprite" style="display:none;">{% include '@BaseTheme/svg/sprite.svg.twig' %}</div>
    <div id="loading"><div id="loading-inner"></div></div>

    {#
     # Main navigation inclusion -----------------------------------------------
     #}
    {% block mainnavigation %}{% include '@BaseTheme/common/nav.html.twig' %}{% endblock %}

    {#
     # Content block -----------------------------------------------------------
     #}
    <div id="main-container">
        {% block content %}{% endblock %}
        <div id="ajax-container"></div>
    </div>

    {#
     # Footer ------------------------------------------------------------------
     #}
    {% include '@BaseTheme/common/footer.html.twig' %}

    <div id="cookiesconsent"></div>

    {#
     # Polyfills sections ðŸ˜±ðŸ˜±--------------------------------------------------
     #}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es6-promise/4.1.1/es6-promise.auto.min.js"
            integrity="sha256-OI3N9zCKabDov2rZFzl8lJUXCcP7EmsGcGoP6DMXQCo="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/MutationObserver.js/0.3.2/mutationobserver.min.js"
            integrity="sha256-BnmK1H6/rOiNcr4iGCjIyQqSO9hnMBZGJ0inXObQrTY="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.3/fetch.min.js"
            integrity="sha256-aB35laj7IZhLTx58xw/Gm1EKOoJJKZt6RY+bH1ReHxs="
            crossorigin="anonymous"></script>

    {% if head.devMode %}
        <script src="{{ head.resourcesUrl }}vendors/cookieconsent.min.js"></script>
        <script src="{{ head.resourcesUrl }}vendors/jquery.min.js"></script>
        <script src="{{ head.resourcesUrl }}vendors/jquery.waitforimages.min.js"></script>
        <script src="{{ head.resourcesUrl }}vendors/loglevel.min.js"></script>
    {% else %}
        {#
         # Better use CDN JS libs if you are planning to use HTTP/2
         # protocol. cdnjs.cloudflare.com serves libs as H2 for better performances.
         #}
        <script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.6/cookieconsent.min.js"
                integrity="sha256-bPOd70Y8ohKatGmjL6tszdveppYZCunsUfLOq7v8JBw="
                crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"
                integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
                crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.waitforimages/2.2.0/jquery.waitforimages.min.js"
                integrity="sha256-b9bqxZdvRHQNAL/WJysGQ/mFHym7gGjEtruZ6zTNm7c="
                crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/loglevel/1.6.1/loglevel.min.js"
                integrity="sha256-AfynOKFjHWwlIEH3xY8lNK2sm2P2rxyiA749uLUXPh4="
                crossorigin="anonymous"></script>
    {% endif %}

    <noscript><div id="no-js-message">{% trans %}no_javascript_message{% endtrans %}</div></noscript>
    <script type="text/javascript">
        {# Passing server vars to JS framework #}
        window.temp = {
            devMode: {% if head.devMode %}true{% else %}false{% endif %},
            locale: '{{ request.locale }}',
            resourcesUrl: '{{ head.resourcesUrl }}',
            googleClientId: '{{ head.googleClientId }}',
            mapsStyle: {% if head.mapsStyle %}JSON.parse('{{ head.mapsStyle|raw }}'){% else %}null{% endif %}
        };

        {# Cookie consent #}
        window.addEventListener('load', function () {
            window.cookieconsent.initialise({
                container: document.getElementById("cookiesconsent"),
                location: false,
                revokable: false,
                law: {
                    countryCode: 'FR', {# Adapt it to your country #}
                    regionalLaw: false,
                },
                content: {
                    message: "{{ 'cookie_choice.consent_message'|trans|escape }}",
                    dismiss: "{% trans %}cookie_choice.close_message{% endtrans %}",
                    link: "{% trans %}cookie_choice.find_out_more_message{% endtrans %}",
                    href: '{{ path(themeServices.nodeSourceLegals) }}'
                }
            })
        });

        {# Browser update â€” www.browser-update.org/customize.html #}
        var $buoop = {
            vs: { i: -6, f: -6, o: -6, s: -4, c: -6 },
            text:'{{ 'browser_update.message'|trans|escape }} <a href="http://browser-update.org/update-browser.html" target="_blank">{{ 'browser_update.link'|trans|escape }}</a>'
        };

        function $buo_f(){
            var e = document.createElement("script");
            e.src = "https://browser-update.org/update.js";
            document.body.appendChild(e);
        }

        try {
            document.addEventListener("DOMContentLoaded", $buo_f,false)
        } catch (e){
            window.attachEvent("onload", $buo_f)
        }

        {% if head.universalAnalyticsId and not head.googleTagManagerId %}
        {# Google Analytics: change head.universalAnalyticsId to be your site ID.  #}
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', '{{ head.universalAnalyticsId }}', 'auto');
        ga('send', 'pageview');
        {% endif %}

    </script>
    {#
     # JS scripts inclusions ---------------------------------------------------
     # Using gulp-inject
     # @see static/gulp-tasks/inject.js
     #}
    {% include '@BaseTheme/partials/js-inject.html.twig' %}
</body>
</html>
